!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.fibrelite=t()}(this,function(){return function(e,t){var n=this,r=[];this.roundRobin=0,this.totalThreads=t||1,this.totalThreads>20&&(this.totalThreads=20);var o=function(e){n.cachedObjectUrl||(n.cachedObjectUrl=URL.createObjectURL(new Blob(["onmessage=("+function(e){return function(t){Promise.resolve(t.data[1]).then(e.apply.bind(e,e)).then(function(e){postMessage([t.data[0],0,e])},function(e){postMessage([e.data[0],1,""+e])})}}+")("+e+")"])));var t=new Worker(n.cachedObjectUrl),r=0,o={};t.onmessage=function(e){o[e.data[0]][e.data[1]](e.data[2]),o[e.data[0]]=null};var i={resolved:!1,worker:t,fn:function(e){return e=[].slice.call(arguments),new Promise(function(){i.resolved=!1,o[++r]=arguments,t.postMessage([r,e])}).then(function(e){return i.resolved=!0,e})}};return i};this.waitExecute=function(t){return new Promise(function(n,i){return 1===this.totalThreads?r.length&&!1===r[0].resolved&&void 0!==this.lastKnownValue?n(this.lastKnownValue):(r.length||(r[0]=o(e)),this.lastKnownValue=r[0].fn(t),n(this.lastKnownValue)):i(Error("waitExecute requires only use of one worker"))}.bind(n))},this.prioritiseExecute=function(e){return new Promise(function(t,n){return r.length>0&&!1===r[this.totalThreads-1].resolved&&r.pop().worker.terminate(),t(this.execute(e))}.bind(n))},this.execute=function(t){return new Promise(function(n,i){for(;r.length<this.totalThreads;)r.unshift(o(e));var s=r[this.roundRobin].fn(t);return this.roundRobin>=this.totalThreads-1||this.roundRobin++,n(s)}.bind(n))},this.getCurrentWorker=function(){return currentThread.worker}}});
//# sourceMappingURL=fibrelite.umd.js.map
