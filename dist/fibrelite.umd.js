!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.fibrelite=t()}(this,function(){return function(e,t,n){var o=this,r=[];this.roundRobin=0,this.totalThreads=t||1,this.debounce=n||333,this.totalThreads>20&&(this.totalThreads=20);var i=function(e){o.cachedObjectUrl||(o.cachedObjectUrl=URL.createObjectURL(new Blob(["onmessage=("+function(e){return function(t){Promise.resolve(t.data[1]).then(e.apply.bind(e,e)).then(function(e){postMessage([t.data[0],0,e])},function(e){postMessage([e.data[0],1,""+e])})}}+")("+e+")"])));var t=new Worker(o.cachedObjectUrl),n=0,r={};t.onmessage=function(e){r[e.data[0]][e.data[1]](e.data[2]),r[e.data[0]]=null};var i={resolved:!1,worker:t,fn:function(e){return e=[].slice.call(arguments),new Promise(function(){i.resolved=!1,r[++n]=arguments,t.postMessage([n,e])}).then(function(e){return i.resolved=!0,e})}};return i};this.debounceExecute=function(e){return new Promise(function(t,n){var o=this;return this.latestValue=e,t(new Promise(function(t,n){(void 0===o.batchEnds||Date.now()>=o.batchEnds)&&(o.batchEnds=Date.now()+o.debounce),o.latestValue=e,new Promise(function(){setTimeout(function(){o.latestValue!==e&&void 0!==o.lastExecution||(o.lastExecution=o.execute(e).then(function(e){return o.lastKnownResult=e,e}),t(o.lastExecution)),void 0!==o.lastKnownResult&&t(Promise.resolve(o.lastKnownResult)),t(o.lastExecution)},o.batchEnds-Date.now())})}))}.bind(o))},this.prioritiseExecute=function(e){return new Promise(function(t,n){return r.length>0&&!1===r[this.totalThreads-1].resolved&&r.pop().worker.terminate(),t(this.execute(e))}.bind(o))},this.execute=function(t){return new Promise(function(n,o){for(;r.length<this.totalThreads;)r.unshift(i(e));var s=r[this.roundRobin].fn(t);return this.roundRobin>=this.totalThreads-1||this.roundRobin++,n(s)}.bind(o))},this.getCurrentWorker=function(){return currentThread.worker}}});
//# sourceMappingURL=fibrelite.umd.js.map
