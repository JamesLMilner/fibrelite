!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.fibrelite=e()}(this,function(){return function(t,e,n){var o=this,r=[];this.roundRobin=0,this.totalThreads=e||1,this.debounce=n||333,this.totalThreads>20&&(this.totalThreads=20);var i=function(t){o.cachedObjectUrl||(o.cachedObjectUrl=URL.createObjectURL(new Blob(["onmessage=("+function(t){return function(e){Promise.resolve(e.data[1]).then(t.apply.bind(t,t)).then(function(t){postMessage([e.data[0],0,t])},function(t){postMessage([t.data[0],1,""+t])})}}+")("+t+")"])));var e=new Worker(o.cachedObjectUrl),n=0,r={};e.onmessage=function(t){r[t.data[0]][t.data[1]](t.data[2]),r[t.data[0]]=null};var i={resolved:!1,worker:e,fn:function(t){return t=[].slice.call(arguments),new Promise(function(){i.resolved=!1,r[++n]=arguments,e.postMessage([n,t])}).then(function(t){return i.resolved=!0,t})}};return i};this.waitExecute=function(e){return new Promise(function(n,o){var s=this;return this.latestValue=e,r.length||(r[0]=i(t)),n(new Promise(function(t,n){(!s.nextBatch||Date.now()>=s.nextBatch)&&(s.nextBatch=Date.now()+s.debounce),s.latestValue=e;var o=s.nextBatch-Date.now();new Promise(function(){setTimeout(function(){s.latestValue!==e&&void 0!==s.lastExecution||(s.lastExecution=s.execute(e).then(function(t){return s.lastKnownResult=t,t}),t(s.lastExecution)),void 0!==s.lastKnownResult&&t(Promise.resolve(s.lastKnownResult)),t(s.lastExecution)},o)})}))}.bind(o))},this.prioritiseExecute=function(t){return new Promise(function(e,n){return r.length>0&&!1===r[this.totalThreads-1].resolved&&r.pop().worker.terminate(),e(this.execute(t))}.bind(o))},this.execute=function(e){return new Promise(function(n,o){for(;r.length<this.totalThreads;)r.unshift(i(t));var s=r[this.roundRobin].fn(e);return this.roundRobin>=this.totalThreads-1||this.roundRobin++,n(s)}.bind(o))},this.getCurrentWorker=function(){return currentThread.worker}}});
//# sourceMappingURL=fibrelite.umd.js.map
