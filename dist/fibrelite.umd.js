!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):t.fibrelite=n()}(this,function(){return function(t,n,e){var i=this,s=[];this.roundRobin=0,this.totalThreads=n||1,this.debounce=e||333,this.debounceId=0,this.firstPrioritiseCall=!0,this.totalThreads>20&&(this.totalThreads=20);var o=function(t){var n=0,e={},i=new Worker("data:,$$="+t+";onmessage="+function(t){Promise.resolve(t.data[1]).then(function(t){return $$.apply($$,t)}).then(function(n){postMessage([t.data[0],0,n],[n].filter(function(t){return t instanceof ArrayBuffer||t instanceof MessagePort||t instanceof ImageBitmap}))},function(n){postMessage([t.data[0],1,""+n])})}),s={resolved:!1,worker:i,fn:function(){var t=[].slice.call(arguments);return new Promise(function(){e[++n]=arguments,i.postMessage([n,t],t.filter(function(t){return t instanceof ArrayBuffer||t instanceof MessagePort||t instanceof ImageBitmap}))})}};return i.onmessage=function(t){s.resolved=!0,e[t.data[0]][t.data[1]](t.data[2]),e[t.data[0]]=null},s};this.debounce=function(){var t=arguments;return new Promise(function(n,e){var i=this,s=[].slice.call(t);return(void 0===this.batchEnds||Date.now()>=this.batchEnds)&&(this.batchEnds=Date.now()+this.debounce),this.finalArgsInBatch=s,n(new Promise(function(t){setTimeout(function(){i.finalArgsInBatch!==s&&void 0!==i.lastExecution||(i.lastExecution=i.execute.apply(i,i.finalArgsInBatch).then(function(t){return i.lastKnownResult=t,t}),t(i.lastExecution)),void 0!==i.lastKnownResult&&t(i.lastKnownResult),t(i.lastExecution)},i.batchEnds-Date.now())}))}.bind(this))}.bind(this),this.prioritise=function(){var t=arguments;return new Promise(function(n,e){return this.firstPrioritiseCall||this.terminateAll(),this.firstPrioritiseCall=!1,n(this.execute.apply(this,[].slice.call(t)))}.bind(this))}.bind(this),this.execute=function(){var n=arguments;return new Promise(function(e,i){for(var r=[].slice.call(n);s.length<this.totalThreads;)s.unshift(o(t));var a=s[this.roundRobin].fn.apply(null,r);return this.roundRobin>=this.totalThreads-1?this.roundRobin=0:this.roundRobin++,e(a)}.bind(this))}.bind(this),this.getWorkers=function(){return s.concat()},this.terminateAll=function(){s.length>0&&!1===s[i.totalThreads-1].resolved&&s.pop().worker.terminate()}}});
//# sourceMappingURL=fibrelite.umd.js.map
